{% extends "SHOP/common.html" %}
{% block content %}

<!-- BREADCRUMB START -->
<div class="rv-breadcrumb pt-120 pb-120">
    <div class="container text-center">
        <h1 class="rv-breadcrumb__title">View Orders</h1>
        <ul class="rv-breadcrumb__nav d-flex justify-content-center">
            <li><a href="/shopHome">Dashboard</a></li>
            <li class="current-page">
                <span class="dvdr"> / </span><span>Shop Orders</span>
            </li>
        </ul>
    </div>
</div>
<!-- BREADCRUMB END -->

<section class="py-5">
    <div class="container">
        <h2 class="text-white mb-4">Incoming Orders</h2>

        <div class="table-responsive">
            <table class="table table-dark table-hover table-bordered">
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>User</th>
                        <th>Product(s)</th>
                        <th>Total Amount</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in orders %}
                    <tr>
                        <td>#{{ order.id }}</td>
                        <td>{{ order.user.first_name }} {{ order.user.last_name }}</td>
                        <td>
                            <ul class="list-unstyled mb-0">
                                {% for item in order.items.all %}
                                <li class="d-flex align-items-center gap-2 mb-1">
                                    {% if item.product.image %}
                                    <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}"
                                        style="width: 30px; height: 30px; object-fit: cover; border-radius: 4px;">
                                    {% endif %}
                                    <span>{{ item.product.name }} (x{{ item.quantity }}) - ₹{{ item.price }}</span>
                                </li>
                                {% endfor %}
                            </ul>
                        </td>
                        <td>₹{{ order.total_amount }}</td>
                        <td>{{ order.created_at|date:"M d, Y" }}</td>
                        <td>
                            <span class="badge 
                                {% if order.status == 'delivered' %}
                                    bg-success
                                {% elif order.status == 'pending' %}
                                    bg-warning
                                {% elif order.status == 'cancelled' %}
                                    bg-danger
                                {% else %}
                                    bg-info
                                {% endif %}">
                                {{ order.status|title }}
                            </span>
                        </td>
                        <td>
                            <form action="/updateOrderStatus/" method="POST" class="d-flex gap-1">
                                {% csrf_token %}
                                <input type="hidden" name="order_id" value="{{ order.id }}">

                                <select name="status" class="form-select form-select-sm" required>
                                    <option value="pending" {% if order.status == 'pending' %}selected{% endif %}>
                                        Pending
                                    </option>

                                    <option value="shipped" {% if order.status == 'shipped' %}selected{% endif %}>
                                        Shipped
                                    </option>

                                    <option value="delivered" {% if order.status == 'delivered' %}selected{% endif %}>
                                        Delivered
                                    </option>

                                    <option value="cancelled" {% if order.status == 'cancelled' %}selected{% endif %}>
                                        Cancelled
                                    </option>
                                </select>

                                <button type="submit" class="btn btn-sm btn-primary">
                                    Update
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" class="text-center">No orders found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</section>

{% endblock %}